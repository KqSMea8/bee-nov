<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="icon" href="../../../../favicon.ico">

  <title></title>
  <link href="/static/css/mescroll.css" />
  <!-- Bootstrap core CSS -->
  <link href="/static/css/bootstrap.css" rel="stylesheet">
  <script src="/static/js/jquery-3.3.1.js"></script>

  <!-- Custom styles for this template -->
  <link href="/static/css/carousel.css" rel="stylesheet">
</head>

<body>

  {{template "header.html" .}}

  <main role="main" style="margin:0  10%" id="mainbody">
    <style>
      .carousel-item{
                  background: #ffffff;
                  min-width: 500px;
              }
      .carousel-inner{
                  border: 1px solid #aeda11;
      }
      </style>
    <div id="myCarousel" class="carousel slide" data-ride="carousel">
      <ol class="carousel-indicators">
        {{ range $ik, $bk := .BkList }}
        {{ if eq $ik 0}}
        <li data-target="#myCarousel" data-slide-to="{{$ik}}" class="active"></li>
        {{ else}}
        <li data-target="#myCarousel" data-slide-to="{{$ik}}"></li>
        {{end}}
        {{end}}
        </li>
      </ol>
      <div class="carousel-inner">
        {{ range $ik, $bk := .BkList }}
        {{ if eq $ik 0}}
        <div class="carousel-item active inline-block">
          {{ else}}
          <div class="carousel-item inline-block">
            {{end}}
            <div class="row d-flex p-3">
              <div class="col-md-7">
                <div>
                  <td>
                    <font>书名： {{$bk.Name}}</font>
                  </td>
                </div>
                <div>
                  <td>
                    <font>作者： {{$bk.Author}}</font>
                  </td>
                </div>
                <div>
                  <td style="width:80%">
                    <font>简介： {{$bk.Profile}}</font>
                  </td>
                  <td>
                  </td>
                </div>
              </div>
                <img style="height: 400px;width: 100%; object-fit: scale-down;" class="col-lg-3 col-md-4 col-xs-10" src="/static/image/{{$bk.Image}}"
                  onload="function a(){alert('loggg')}"></img>
            </div>
          </div>
          {{end}}
        </div>
      </div>


      <!-- Marketing messaging and featurettes
      ================================================== -->
      <!-- Wrap the rest of the page in another container to center all the content. -->

      <div class="album py-5 bg-light">
        <div id="mescroll" class="container">
          <div class="row" id="mediv">
            <style>
              .card1{
                min-width: 300px;
                max-height: 400px
              } 
               .mescroll{
              top: 44px;
              bottom: 51px;
              height: auto;
            }
            </style>
            {{ range $ik, $bk := .BkList }}
            <!-- it -->
            <div class="col-md-6 col-xs-12 col-lg-3 col-sm-12">
              <div class="card mb-4">
                <img class="card-img-top" data-src="holder.min.js/100px225?theme=thumb&bg=55595c&fg=eceeef&text=Thumbnail"
                  alt="Card image cap">
                <div class="card-body">
                  <p class="card-text">This is a wider card with supporting text below as a natural lead-in to
                    additional content. This content is a little bit longer.</p>
                  <div class="d-flex justify-content-between align-items-center">
                    <div class="btn-group">
                      <button type="button" class="btn btn-sm btn-outline-secondary">View</button>
                      <button type="button" class="btn btn-sm btn-outline-secondary">Edit</button>
                    </div>
                    <small class="text-muted">9 mins</small>
                  </div>
                </div>
              </div>
            </div>
            {{end}}
          </div>
        </div>
      </div>
      <div>

        <script>
          $(function () {
            var mescroll = new MeScroll("body", { //第一个参数"mescroll"对应上面布局结构div的id (1.3.5版本支持传入dom对象)
              up: {
                auto: true, isBoth: true,
                callback: upCallback, //上拉加载回调,简写callback:function(page){upCallback(page);}
                //以下是一些常用的配置,当然不写也可以的.
                page: {
                  num: 0, //当前页 默认0,回调之前会加1; 即callback(page)会从1开始
                  size: 6, //每页数据条数,默认10
                },
                htmlNodata: '<p class="upwarp-nodata">亲,没有更多数据了~</p>',
                noMoreSize: 2, //如果列表已无数据,可设置列表的总数量要大于5才显示无更多数据;避免列表数据过少(比如只有一条数据),显示无更多数据会不好看.这就是为什么无更多数据 有时候不显示的原因了.

                lazyLoad: {
                  use: true, // 是否开启懒加载,默认false
                  attr: '/static/img/mlab.png', // 网络图片地址的属性名 (图片加载成功会自动移除改属性): <img imgurl='网络图  src='占位图''/>
                  offset: 1500 // 超出可视区域多少px的图片仍可触发懒加载 默认200. 目的是提前加载可视区域外的部分图片
                }
              }
            });
            //上拉加载的回调 page = {num:1, size:10}; num:当前页 从1开始, size:每页数据条数
            function upCallback(page) {
              console.log(page);
              if (page.num > 3) {
                mescroll.endErr(); return;
              }
              $.ajax({
                url: 'bkloader?num=' + page.num + "&size=" + page.size,
                success: function (curPageData) {
                  console.log(curPageData);
                  console.log(curPageData.length);

                  //方法一(推荐): 后台接口有返回列表的总页数 totalPage
                  //必传参数(当前页的数据个数, 总页数)
                  mescroll.endByPage(curPageData.length, curPageData.totalPage);

                  //设置列表数据
                  setListData(curPageData, true);//自行实现 TODO
                },
                error: function () {
                  //联网失败的回调,隐藏下拉刷新和上拉加载的状态
                  mescroll.endErr();
                }
              });
            }

            /*设置列表数据*/
            function setListData(curPageData, isAppend) {
              var listDom = document.getElementById("mediv");
              for (var i = 0; i < curPageData.length; i++) {
                var newObj = curPageData[i];

                //var str='<p>'+newObj.title+'</p>';
                //str+='<p class="new-content">'+newObj.content+'</p>';
                //var liDom=document.createElement("li");
                //liDom.innerHTML=str;

                if (isAppend) {
                  console.log('isappend')
                  $("#mediv").append('<div class="col-md-6 col-xs-12 col-lg-3 col-sm-12">\
                    <div class="card  mb-4 box-shadow">\
                      <img class="card-img-top" data-src="holder.min.js/100px225?theme=thumb&bg=55595c&fg=eceeef&text=Thumbnail"\
                        alt="Card image cap">\
                      <div class="card-body">\
                        <p class="card-text">This is a wider card with supporting text below as a natural lead-in to\
                          additional content. This content is a little bit longer.</p>\
                        <div class="d-flex justify-content-between align-items-center">\
                          <div class="btn-group">\
                            <button type="button" class="btn btn-sm btn-outline-secondary">View</button>\
                            <button type="button" class="btn btn-sm btn-outline-secondary">Edit</button>\
                          </div>\
                          <small class="text-muted">9 mins</small>\
                        </div>\
                      </div>\
                    </div>\
                  </div>');

                  //listDom.appendChild(liDom);//加在列表的后面,上拉加载
                } else {
                  console.log('not append')
                  listDom.insertBefore(liDom, listDom.firstChild);//加在列表的前面,下拉刷新
                }
              }
            }
          });
        </script>
      </div>

  </main>
  <!-- FOOTER -->
  <footer class="container">
    <p class="float-right"><a href="#">Back to top</a></p>
    <p>&copy; 2017-2018 Company, Inc. &middot; <a href="#">Privacy</a> &middot; <a href="#">Terms</a></p>
  </footer>
  <!-- Bootstrap core JavaScript
    ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->



  <script src="/static/js/jquery-3.3.1.js"></script>
  <script src="/static/js/mescroll.js"></script>
  <script src="/static/js/vendor/popper.min.js"></script>
  <script src="/static/js/bootstrap.js"></script>
  <!-- Just to make our placeholder images work. Don't actually copy the next line! -->
  <script src="/static/js/vendor/holder.min.js"></script>
</body>

</html>